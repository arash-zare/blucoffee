# 🚔 سیستم مانیتورینگ نیروی انتظامی (Microservices)

این راهنما به‌صورت جامع و گام‌به‌گام مراحل نصب، راه‌اندازی و پیکربندی سیستم مانیتورینگ را که مبتنی بر معماری ماکروسرویس است، ارائه می‌دهد. 

---

## 📌 پیش‌نیازها

### ۱. نصب Docker

#### **ویندوز**
1. **دانلود و نصب Docker Desktop:**
   - به [وبسایت رسمی Docker](https://www.docker.com/products/docker-desktop) مراجعه کنید.
   - نسخه متناسب با سیستم خود را دانلود و نصب کنید.
   - سیستم خود را ریستارت کنید.

2. **فعال کردن WSL 2 (در صورت نیاز)**
   - PowerShell را باز کرده و دستور زیر را اجرا کنید:
     ```sh
     wsl --install
     ```
   - سپس در Docker Desktop به تنظیمات رفته و **Use WSL 2 based engine** را فعال کنید.

#### **لینوکس**
1. **نصب Docker روی Ubuntu/Debian:**
   ```sh
   sudo apt update && sudo apt install docker.io -y
   sudo systemctl enable --now docker
   ```
2. **افزودن کاربر به گروه Docker (اختیاری):**
   ```sh
   sudo usermod -aG docker $USER
   ```
   سپس یکبار سیستم را ریست کنید یا خروج و ورود مجدد انجام دهید.

---

## 🚀 راه‌اندازی پروژه

### ۱. بارگذاری ایمیج‌های داکر در محیط آفلاین

در محیطی که اینترنت وجود ندارد، فایل `all_images.tar` را در مسیر پروژه قرار داده و سپس دستور زیر را اجرا کنید:
```sh
docker load < all_images.tar
```

### ۲. اجرای سرویس‌ها با Docker Compose

در مسیر پروژه، فایل `docker-compose.yml` را پیدا کرده و دستور زیر را اجرا کنید:
```sh
docker-compose up -d
```
> این دستور سرویس‌ها را در پس‌زمینه اجرا می‌کند.

### ۳. بررسی وضعیت اجرای کانتینرها

برای مشاهده‌ی وضعیت سرویس‌های در حال اجرا، دستور زیر را اجرا کنید:
```sh
docker ps
```
> در صورتی که مشکلی در اجرا وجود داشت، می‌توانید لاگ‌ها را بررسی کنید:
```sh
docker-compose logs -f
```

---




## 📊 تنظیمات Grafana

### ۱. ورود به داشبورد Grafana
پس از اجرای سرویس‌ها، مرورگر را باز کرده و به آدرس زیر بروید:
```
http://localhost:3000
```
ورود به حساب کاربری:
- **Username:** `admin`
- **Password:** `admin` (در اولین ورود تغییر رمز الزامی است)

### ۲. اضافه کردن Data Source به Grafana
1. در داشبورد Grafana به **Configuration** → **Data Sources** بروید.
2. روی **Add data source** کلیک کنید.
3. **Prometheus** را انتخاب کنید.
4. در قسمت `URL` مقدار زیر را وارد کنید:
   ```
   http://victoriametrics:8428

   ```

5. روی **Save & Test** کلیک کنید.


### ۳. ایمپورت کردن داشبوردهای آ
ماده
1. به **Manage Dashboards** در Grafana بروید.
2. روی **Import** کلیک کنید.
3. یک **Dashboard ** معتبر را وارد کنید یا فایل JSON داشبورد موردنظر را آپلود کنید.
4. Data Source را روی **Prometheus** تنظیم کرده و Import را بزنید.



## 🔧 مدیریت سرویس‌ها

### ۱. متوقف کردن اجرای سرویس‌ها
```sh
docker-compose down
```

### ۲. حذف تمام کانتینرها و ایمیج‌ها

اگر می‌خواهید تمام سرویس‌ها، ایمیج‌ها و داده‌های ذخیره‌شده را حذف کنید:
```sh
docker system prune -a
```

---

## 🔍 بررسی مشکلات و دیباگ

### ۱. مشاهده لاگ‌های سرویس خاصی:
```sh
docker logs -f <container_id>
```

### ۲. ورود به داخل کانتینر برای بررسی دقیق‌تر:
```sh
docker exec -it <container_id> /bin/sh
```

### ۳. بررسی وضعیت سیستم و منابع مصرفی کانتینرها:
```sh
docker stats
```

---

## 📢 نتیجه‌گیری

با اجرای این راهنما، سیستم مانیتورینگ نیروی انتظامی با معماری **ماکروسرویس** و ابزارهای **Grafana** و **Prometheus** به‌صورت کامل راه‌اندازی شد. این سیستم امکان نظارت دقیق بر داده‌ها را فراهم کرده و قابلیت مقیاس‌پذیری بالایی دارد. لطفاً در صورت نیاز به تغییرات بیشتر، فایل‌های `docker-compose.yml` و `prometheus.yml` را بررسی و ویرایش کنید. 🚀

